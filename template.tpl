___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "ACM Site Tracking",
  "categories": ["CONVERSIONS", "ADVERTISING"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Official template for Adssets/ACM ad server built for conversion and custom tracking, allowing extra flexibility to the service.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "advertiserId",
    "displayName": "Advertiser ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "POSITIVE_NUMBER"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "conversionEvent",
    "displayName": "Conversion events",
    "selectItems": [
      {
        "value": "Conversion_1",
        "displayValue": "Conversion 1"
      },
      {
        "value": "Conversion_2",
        "displayValue": "Conversion 2"
      },
      {
        "value": "Conversion_3",
        "displayValue": "Conversion 3"
      },
      {
        "value": "Landing_Page_1",
        "displayValue": "Landing page 1"
      },
      {
        "value": "Landing_Page_2",
        "displayValue": "Landing page 2"
      },
      {
        "value": "Landing_Page_3",
        "displayValue": "Landing page 3"
      }
    ],
    "simpleValueType": true,
    "notSetText": "\"Not set\""
  },
  {
    "type": "SELECT",
    "name": "typeOfId",
    "displayName": "Type of ID",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "productId",
        "displayValue": "Product Id"
      },
      {
        "value": "productName",
        "displayValue": "Product name"
      },
      {
        "value": "category",
        "displayValue": "Category"
      },
      {
        "value": "manufacturer",
        "displayValue": "Manufacturer"
      },
      {
        "value": "title",
        "displayValue": "Title"
      },
      {
        "value": "destination",
        "displayValue": "Destination"
      },
      {
        "value": "destinationId",
        "displayValue": "Destination ID"
      },
      {
        "value": "country",
        "displayValue": "Country"
      },
      {
        "value": "area",
        "displayValue": "Area"
      },
      {
        "value": "other",
        "displayValue": "Other"
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "id",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "displayName": "Value of ID"
  },
  {
    "type": "SELECT",
    "name": "interaction",
    "displayName": "Interaction",
    "macrosInSelect": true,
    "selectItems": [
      {
        "value": "viewed_",
        "displayValue": "Viewed"
      },
      {
        "value": "bought_",
        "displayValue": "Bought"
      }
    ],
    "simpleValueType": true,
    "notSetText": "\"Not set\""
  },
  {
    "type": "SELECT",
    "name": "retargeting",
    "displayName": "Retargeting DSP",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "none",
        "displayValue": "None"
      },
      {
        "value": "appnexus",
        "displayValue": "Xandr"
      }
    ],
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const callInWindow = require('callInWindow');
const log = require('logToConsole');
const setInWindow = require('setInWindow');
const createQueue = require('createQueue');

//log(data);
const pushEvents = createQueue('adss_event_to_be_sent');
const pushPixels = createQueue('adss_pixels_to_be_sent');

const urltemplate = {
                    "none":"https://ext.pliing.com/rtg/sk?AdvId=<advId>&Kw=<kwd>",
                    "appnexus":"https://ib.adnxs.com/getuid?https://ext.pliing.com/rtg/sk?AdvId=<advId>&Kw=<kwd>&userId=$UID"
                 };


if(data.advertiserId){
  
    if(data.conversionEvent && data.conversionEvent!= "none"){
        pushEvents( data.conversionEvent);
    }
  
    const isConsentGranted = require('isConsentGranted');
  
    let consentCookies = isConsentGranted('ad_storage');
    let cookiesConsentRetargeting = isConsentGranted('personalization_storage');
  
    if(data.id && data.interaction){
      if(cookiesConsentRetargeting==true){
        let pixel_ids = data.id.split(",");
        pixel_ids.forEach(function (pixel_id){
            log("pixel_added::" + pixel_id);
            pushPixels( urltemplate[ data.retargeting ].replace("<advId>",data.advertiserId).replace("<kwd>", data.interaction + pixel_id )  );
        });
      }else{
        let pixel_ids = data.id.split(",");
        pixel_ids.forEach(function (pixel_id){
            pushPixels( urltemplate.none.replace("<advId>",data.advertiserId).replace("<kwd>", data.interaction + pixel_id ) + "&userId=0" );
        });
      }
    }else{
      log("No interaction selected");
    }
  
  
//  log('LIB:: https://mdc.pliing.com/sync/libs/track/adstrackpage.1.3.4.js?consent=' + consent + '&advertiserid=' + data.advertiserId);
  
    injectScript('https://mdc.pliing.com/sync/libs/track/adstrackpage.1.3.4.js?consent=' + consentCookies + '&retargeting=' + cookiesConsentRetargeting + '&advertiserid=' + data.advertiserId, 
    data.gtmOnSuccess, data.gtmOnFailure, 'adssLib');
}else{
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://mdc.pliing.com/sync/libs/track/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "adsscore_land.AdssEventByName"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "adss_event_to_be_sent"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "adss_pixels_to_be_sent"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Tack successfully executed
  code: |-
    const mockData = {
      cookiesConsent: true,
      advertiserId:27,
      conversionEvent:"",
      productId:undefined,
      viewedOrBought:undefined
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 10/10/2022, 4:01:36 PM


